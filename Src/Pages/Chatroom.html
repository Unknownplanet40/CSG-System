<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="../../Utilities/Third-party/Bootstrap/css/bootstrap.css"
    />
    <title>Chatroom</title>
  </head>
  <body>
    <div class="container text-center mt-5">
      <div class="card">
        <div
          class="card-body position-relative"
          id="ChatRoom"
          style="height: 60svh; overflow-y: auto"
        >
          <div class="d-flex flex-row justify-content-start">
            <div>
              <p class="small p-2 ms-2 mb-1 rounded-3 bg-body-secondary">Hi</p>
              <p class="small ms-2 mb-3 rounded-3 text-secondary">23:58</p>
            </div>
          </div>
          <div class="d-flex flex-row justify-content-end mb-4 pt-1">
            <div>
              <p class="small p-2 me-2 mb-1 text-white rounded-3 bg-primary">
                Hiii, I'm good.
              </p>
              <p
                class="small me-2 mb-3 rounded-3 text-muted d-flex justify-content-end"
              >
                00:06
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="card-footer m-3">
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            placeholder="Type your message here..."
            id="message"
          />
          <div class="input-group-append">
            <button class="btn btn-primary" id="send">Send</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.getElementById("send").addEventListener("click", function () {
        var message = {
          message: document.getElementById("message").value,
          time: new Date().toLocaleTimeString(),
        };

        conn.send(JSON.stringify(message));
      });

      var conn = new WebSocket("ws://localhost:8080");
      conn.onopen = function (e) {
        console.log("Connection established!");
      };

      conn.onmessage = function (e) {
        console.log(e.data);

        var chatRoom = document.getElementById("ChatRoom");

        var message = JSON.parse(e.data);

        var div = document.createElement("div");
        div.className = "d-flex flex-row justify-content-start";
        var div2 = document.createElement("div");
        var p = document.createElement("p");
        p.className = "small p-2 ms-2 mb-1 rounded-3 bg-body-secondary";
        p.innerText = message.message;
        var p2 = document.createElement("p");
        p2.className = "small ms-2 mb-3 rounded-3 text-secondary";
        p2.innerText = message.time;
        div2.appendChild(p);
        div2.appendChild(p2);
        div.appendChild(div2);
        chatRoom.appendChild(div);
        
        chatRoom.scrollTop = chatRoom.scrollHeight;
      };
    </script>
  </body>
</html>
